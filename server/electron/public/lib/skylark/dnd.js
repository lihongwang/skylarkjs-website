/**
 * skylark - An Elegant JavaScript Library and HTML5 Application Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark/skylark","skylark/langx","skylark/noder","skylark/datax","skylark/geom","skylark/eventer","skylark/styler"],function(r,a,e,n,t,g,s){function i(r,a){return new c(r,a)}function d(r,a){return new u(r,a)}function o(){return o}var f=(g.on,g.off,n.attr,n.removeAttr,t.pagePosition,s.addClass,t.height,a.Evented.inherit({klassName:"DndManager",init:function(){},start:function(r,e){var n=t.pagePosition(r.elm);this.draggingOffsetX=parseInt(e.pageX-n.left),this.draggingOffsetY=parseInt(e.pageY-n.top);var s=g.create("started",{ghost:null,transfer:{}});r.trigger(s),this.dragging=r,this.draggingGhost=s.ghost,this.draggingGhost||(this.draggingGhost=r.elm),this.draggingTransfer=s.transfer,this.draggingTransfer&&a.each(this.draggingTransfer,function(r,a){e.dataTransfer.setData(r,a)}),e.dataTransfer.setDragImage(this.draggingGhost,this.draggingOffsetX,this.draggingOffsetY),e.dataTransfer.effectAllowed="copyMove",this.trigger(s)},end:function(){var r=g.create("ended",{});this.trigger(r),this.dragging=null,this.draggingTransfer=null,this.draggingGhost=null,this.draggingOffsetX=null,this.draggingOffsetY=null}})),l=new f,c=a.Evented.inherit({klassName:"Draggable",init:function(r,e){var t=this,i=e.draggingClass||"dragging",d=!1;t.elm=r,t._params=e,["started","ended","moving"].forEach(function(r){a.isFunction(e[r])&&t.on(r,e[r])}),g.on(r,{mousedown:function(r){d===!0&&n.prop(t.elm,"draggable",!0)},mouseup:function(r){n.prop(t.elm,"draggable",!1)},dragstart:function(r){l.start(t,r),s.addClass(t.elm,i)},dragend:function(r){g.stop(r),l.dragging&&(s.removeClass(t.elm,i),l.end())}}),e.handle?g.on(r,{mouseenter:function(r){d=!0},mouseleave:function(r){d=!1}},e.handle):d=!0}}),u=a.Evented.inherit({klassName:"Droppable",init:function(r,e){var n,t,i=this,d=(e.draggingClass||"dragging",!0);i.elm=r,i._params=e,["started","ended","entered","leaved","dropped","overing"].forEach(function(r){a.isFunction(e[r])&&i.on(r,e[r])}),g.on(r,{dragover:function(r){if(r.stopPropagation(),d){var a=g.create("overing",{transfer:l.draggingTransfer});i.trigger(a),r.preventDefault(),r.dataTransfer.dropEffect="copyMove"}},dragenter:function(r){var a=(i._params,i.elm),e=g.create("entered",{transfer:l.draggingTransfer});i.trigger(e),r.stopPropagation(),n&&d&&s.addClass(a,n)},dragleave:function(r){var a=(i._params,i.elm);if(!d)return!1;var e=g.create("leaved",{transfer:l.draggingTransfer});i.trigger(e),r.stopPropagation(),n&&d&&s.removeClass(a,n)},drop:function(r){var a=(i._params,i.elm);if(g.stop(r),l.dragging){n&&d&&s.addClass(a,n);var e=g.create("dropped",{transfer:l.draggingTransfer});i.trigger(e),l.end()}}}),l.on("started",function(a){var e=g.create("started",{transfer:l.draggingTransfer,acceptable:!1});i.trigger(e),d=e.acceptable,n=e.hoverClass,t=e.activeClass,t&&d&&s.addClass(r,t)}).on("ended",function(a){var e=g.create("ended",{transfer:l.draggingTransfer,acceptable:!1});i.trigger(e),n&&d&&s.removeClass(r,n),t&&d&&s.removeClass(r,t),d=!1,t=null,n=null})}});return a.mixin(o,{draggable:i,droppable:d,manager:l}),r.dnd=o});